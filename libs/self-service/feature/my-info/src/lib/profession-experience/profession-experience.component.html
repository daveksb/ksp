<ksp-top-nav [isSelfService]="true">
  <span header>ข้อมูลของฉัน</span>
</ksp-top-nav>

<div class="main__container px-4 py-2 full-height">
  <div class="box-header">ข้อมูลประสบการณ์วิชาชีพ</div>
  <div class="detail__container p-3">
    <form [formGroup]="form">
      <div class="border rounded px-3 py-2 mb-3">
        <div class="d-flex justify-content-between align-items-start">
          <div class="fs-5 w-50">สถานศึกษาฝึกประสบการณ์วิชาชีพ</div>
          <div class="d-flex align-items-center">
            <ksp-add-row-button
              *ngIf="mode !== 'view'"
              [disabled]="licenseInfo1.length > 1"
              [class]="'text-primary'"
              (addRowClick)="addFormArray(0)"
            >
              เพิ่ม
            </ksp-add-row-button>

            <div *ngIf="licenseInfo1.length > 0">
              <button
                class="btn btn-link text-secondary w-auto p-0 ms-3"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapseExample1"
                aria-expanded="false"
                aria-controls="collapseExample"
              >
                ดูเพิ่มเติม <i class="bi bi-chevron-down"></i>
              </button>
            </div>
          </div>
        </div>
        <ng-container formArrayName="licenseInfo1">
          <ng-container
            *ngFor="let DegreeForm of licenseInfo1.controls; let i = index"
          >
            <ng-container [formGroupName]="i">
              <div class="collapse show" id="collapseExample1">
                <hr />
                <div class="d-flex justify-content-end" *ngIf="mode === 'edit'">
                  <i
                    class="bi bi-x-circle-fill text-danger"
                    role="button"
                    (click)="deleteFormArray(licenseInfo1, i)"
                  ></i>
                </div>

                <self-service-form-user-training-workplace
                  [mode]="mode"
                  [trainingTimes]="i + 1"
                  formControlName="licenseForm"
                ></self-service-form-user-training-workplace>
              </div> </ng-container></ng-container
        ></ng-container>
      </div>

      <div class="border rounded px-3 py-2 mt-3">
        <div class="d-flex justify-content-between align-items-start">
          <div class="fs-5 w-50">สถานศึกษาที่ปฎิบัติการสอน</div>
          <div class="d-flex align-items-center">
            <ksp-add-row-button
              *ngIf="mode !== 'view'"
              [class]="'text-primary'"
              (addRowClick)="addFormArray(1)"
            >
              เพิ่ม
            </ksp-add-row-button>

            <div *ngIf="licenseInfo2.length > 0">
              <button
                class="btn btn-link text-secondary w-auto p-0 ms-3"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapseExample2"
                aria-expanded="false"
                aria-controls="collapseExample"
              >
                ดูเพิ่มเติม <i class="bi bi-chevron-down"></i>
              </button>
            </div>
          </div>
        </div>

        <ng-container formArrayName="licenseInfo2">
          <ng-container
            *ngFor="let DegreeForm of licenseInfo2.controls; let i = index"
          >
            <ng-container [formGroupName]="i">
              <div class="collapse show" id="collapseExample2">
                <hr />
                <div class="d-flex justify-content-end" *ngIf="mode === 'edit'">
                  <i
                    class="bi bi-x-circle-fill text-danger"
                    role="button"
                    (click)="deleteFormArray(licenseInfo2, i)"
                  ></i>
                </div>
                <self-service-form-user-workplace
                  [mode]="mode"
                  formControlName="licenseForm"
                  [provinces]="provinces1$ | async"
                  [amphurs]="amphurs1$ | async"
                  [tumbols]="tumbols1$ | async"
                  [bureaus]="bureau$ | async"
                  (provinceChanged)="provinceChanged(1, $event)"
                  (amphurChanged)="amphurChanged(1, $event)"
                ></self-service-form-user-workplace>
              </div> </ng-container></ng-container
        ></ng-container>
      </div>

      <div class="border rounded px-3 py-2 mt-3">
        <div class="d-flex justify-content-between align-items-start">
          <div class="fs-5 w-50">
            หนังสืออนุญาตประกอบวิชาชีพครูจากต่างประเทศ
          </div>
          <div class="d-flex align-items-center">
            <ksp-add-row-button
              *ngIf="mode !== 'view'"
              [class]="'text-primary'"
              (addRowClick)="addFormArray(2)"
            >
              เพิ่ม
            </ksp-add-row-button>

            <div *ngIf="licenseInfo3.length > 0">
              <button
                class="btn btn-link text-secondary w-auto p-0 ms-3"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapseExample3"
                aria-expanded="false"
                aria-controls="collapseExample"
              >
                ดูเพิ่มเติม <i class="bi bi-chevron-down"></i>
              </button>
            </div>
          </div>
        </div>
        <ng-container formArrayName="licenseInfo3">
          <ng-container
            *ngFor="let DegreeForm of licenseInfo3.controls; let i = index"
          >
            <ng-container [formGroupName]="i">
              <div class="collapse show" id="collapseExample3">
                <hr />
                <div class="d-flex justify-content-end" *ngIf="mode === 'edit'">
                  <i
                    class="bi bi-x-circle-fill text-danger"
                    role="button"
                    (click)="deleteFormArray(licenseInfo3, i)"
                  ></i>
                </div>
                <ksp-experience-form
                  [mode]="mode"
                  [countries]="countries$ | async"
                  [licenses]="licenses$ | async"
                  formControlName="licenseForm"
                ></ksp-experience-form>
              </div> </ng-container></ng-container
        ></ng-container>
      </div>
      <div class="mt-3">
        <ksp-form-attachment
          [groups]="info"
          [title]="'กรุณาแนบหลักฐานประกอบวุฒิทางการศึกษา'"
        ></ksp-form-attachment>
      </div>
    </form>
  </div>
  <div class="d-flex justify-content-center my-3">
    <button
      type="button"
      class="btn text-secondary bg-light border-secondary me-2"
      (click)="clear()"
    >
      ล้างข้อมูล
    </button>
    <button
      type="button"
      class="btn"
      (click)="onSave()"
      [ngClass]="mode === 'edit' ? 'btn-success' : 'btn-primary'"
    >
      {{ label }}
    </button>
  </div>
</div>
