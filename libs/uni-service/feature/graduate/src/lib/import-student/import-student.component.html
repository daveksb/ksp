<ksp-top-nav>
  <span header>{{ pageType === 'studentList' ? headerStudent.h1 : headerGraduate.h1 }}</span>
  <span subHeader>{{ pageType === 'studentList' ? headerStudent.h2 : headerGraduate.h2 }}</span>
  <span detail> > {{ pageType === 'studentList' ? headerStudent.h3 : headerGraduate.h3 }}</span>
</ksp-top-nav>

<div class="bg-secondary bg-opacity-10 px-4 py-2 full-height full-width-2">
  <div class="box-header">รายละเอียดใบคำขอ</div>

  <div class="bg-white p-3">
    <ksp-request-header-info
      [requestDate]="'10 ตุลาคม 2565'"
      [requestNumber]="'112234467876543'"
    ></ksp-request-header-info>
    <hr />

    <div class="d-flex justify-content-between mb-1">
      <div class="box-header">{{ pageType === 'studentList' ? headerStudent.h3 : headerGraduate.h3 }}</div>
      <div *ngIf="pageType === 'studentList'">
        <button
          type="button"
          (click)="downloadfile()"
          class="btn border-success text-success w-auto me-2"
        >
          <img src="/assets/images/img-uni/microsoft excel.png" />
          ดาวน์โหลดแบบฟอร์ม
        </button>

        <ng-container>
          <button
            (click)="fileUpload.click()"
            type="button"
            class="btn btn-sm btn-primary w-auto"
          >
            <img src="/assets/images/img-uni/Upload.svg" /> อัปโหลดไฟล์
          </button></ng-container
        >
        <input
          hidden="true"
          type="file"
          (change)="onFileSelected($event)"
          #fileUpload
        />
      </div>
    </div>

    <div class="table">
      <p-table
        [value]="users"
        responsiveLayout="scroll"
        dataKey="index"
        editMode="row"
      >
        <ng-template pTemplate="header">
          <tr>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'graduateList'"
            >
              เลือก
            </th>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'studentList'"
            >
              ลำดับ
            </th>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'graduateList'"
            >
              ครั้งที่สภาอนุมัติ
            </th>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'graduateList'"
            >
              วันที่สภาอนุมัติ
            </th>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'graduateList'"
            >
              วันที่จบการศึกษา
            </th>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'graduateList'"
            >
              สถานที่ปฏิบัติการสอน
            </th>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'studentList'"
            >
              วันที่รับเข้า
            </th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === 'graduateList'"
            >
              <div>
                <label>วันที่เข้ารับการศึกษา</label>
                <input type="date" class="form-control" style="width: 150px" />
              </div>
            </th>

            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === 'studentList'"
            >
              เลขบัตรประจำตัวประชาชน /<br />
              เลขประจำตัวคุรุสภา
            </th>

            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === 'graduateList'"
            >
              <div>
                เลขบัตรประจำตัวประชาชน
                <input
                  class="form-control form-search"
                  style="width: 175px"
                  type="text"
                />
              </div>
            </th>

            <th class="p-2 text-nowrap align-text-top">
              หมายเลขหนังสือเดินทาง
              <input
                class="form-control form-search"
                style="width: 175px"
                type="text"
                *ngIf="pageType === 'graduateList'"
              />
            </th>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'studentList'"
            >
              สัญชาติ
            </th>

            <th class="p-2 text-nowrap align-text-top" style="width: 5rem">
              คำนำหน้าชื่อ
            </th>

            <th class="p-2 text-nowrap align-text-top" style="width: 5rem">
              ชื่อ (ภาษาไทย)
              <div>
                <input
                  class="form-control form-search"
                  style="width: 150px"
                  type="text"
                  *ngIf="pageType === 'graduateList'"
                />
              </div>
            </th>

            <th class="p-2 text-nowrap align-text-top" style="width: 5rem">
              นามสกุล (ภาษาไทย)
              <div>
                <input
                  class="form-control form-search"
                  style="width: 150px"
                  type="text"
                  *ngIf="pageType === 'graduateList'"
                />
              </div>
            </th>

            <th class="p-2 text-nowrap align-text-top" style="width: 5rem">
              คำนำหน้าชื่อ
            </th>

            <th class="p-2 text-nowrap align-text-top" style="width: 5rem">
              ชื่อ (ภาษาอังกฤษ)
              <div>
                <input
                  class="form-control form-search"
                  style="width: 150px"
                  type="text"
                  *ngIf="pageType === 'graduateList'"
                />
              </div>
            </th>

            <th class="p-2 text-nowrap align-text-top" style="width: 5rem">
              ชื่อกลาง (ภาษาอังกฤษ)
              <div>
                <input
                  class="form-control form-search"
                  style="width: 150px"
                  type="text"
                  *ngIf="pageType === 'graduateList'"
                />
              </div>
            </th>

            <th class="p-2 text-nowrap align-text-top" style="width: 5rem">
              นามสกุล (ภาษาอังกฤษ)
              <div>
                <input
                  class="form-control form-search"
                  style="width: 150px"
                  type="text"
                  *ngIf="pageType === 'graduateList'"
                />
              </div>
            </th>

            <th class="p-2 text-nowrap align-text-top">
              เบอร์โทรศัพท์มือถือ
              <input
                class="form-control form-search"
                style="width: 150px"
                type="text"
                *ngIf="pageType === 'graduateList'"
              />
            </th>
            <th class="p-2 text-nowrap align-text-top">
              วัน/เดือน/ปีเกิด(พ.ศ.)
            </th>
            <th class="p-2 text-nowrap align-text-top">ที่อยู่</th>
            <th
              class="p-2 text-nowrap align-text-top"
              *ngIf="pageType === 'studentList'"
            >
              รายวิชา
            </th>
            <th class="p-2 text-nowrap"></th>
          </tr>
        </ng-template>
        <ng-template
          pTemplate="body"
          let-product
          let-editing="editing"
          let-ri="rowIndex"
          let-expanded="expanded"
        >
          <tr [pEditableRow]="product">
            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === 'studentList'"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  {{ product.index }}
                </ng-template>

                <ng-template pTemplate="output">
                  {{ product.index }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td
              class="text-center"
              *ngIf="pageType === 'graduateList'"
            >
              <input type="checkbox" [(ngModel)]="product.checked" class="form-check-input" />
            </td>

            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === 'graduateList'"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control text-center"
                    style="width: 75px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.approvetime"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.approvetime }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === 'graduateList'"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="date"
                    [(ngModel)]="product.graduatedate"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.graduatedate }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === 'graduateList'"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="date"
                    [(ngModel)]="product.approvedate"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.approvedate }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === 'graduateList'"
            >
              <div
                (click)="searchAddress()"
                class="text-orange text-decoration-underline whitespace-nowrap"
                role="button"
              >
                สถานที่ปฏิบัติการสอน
              </div>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="date"
                    [(ngModel)]="product.startdate"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.startdate }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 175px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.idcard"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.idcard }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 175px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.passportno"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.passportno }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === 'studentList'"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <select 
                    class="form-select" 
                    style="width: 150px"
                    (change)="selectedNationality($event, product.index)"
                    [(ngModel)]="product.nationalityid">
                    <option
                      *ngFor="let nation of nationality"
                      [value]="nation.nationId"
                    >
                      {{ nation.nationName }}
                    </option>
                  </select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.nationality }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <select
                    class="form-select"
                    style="width: 100px"
                    [disabled]="pageType === 'graduateList'"
                    [(ngModel)]="product.titlethid"
                    (change)="selectedPrefixTh($event, product.index)"
                  >
                    <option
                      *ngFor="let ThPrefix of ThPrefixes"
                      [value]="ThPrefix.id"
                    >
                      {{ ThPrefix.name_th }}
                    </option>
                  </select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.titleth }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.firstnameth"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.firstnameth }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.lastnameth"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.lastnameth }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <select
                    class="form-select"
                    style="width: 100px"
                    [disabled]="pageType === 'graduateList'"
                    [(ngModel)]="product.titleenid"
                    (change)="selectedPrefixEn($event, product.index)"
                  >
                    <option
                      *ngFor="let EngPrefix of EngPrefixes"
                      [value]="EngPrefix.id"
                    >
                      {{ EngPrefix.name_en }}
                    </option>
                  </select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.titleen }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.firstnameen"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.firstnameen }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.middlenameen"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.middlenameen }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.lastnameen"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.lastnameen }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.contactphone"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.contactphone }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="date"
                    [(ngModel)]="product.birthdate"
                    [disabled]="pageType === 'graduateList'"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.birthdate }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <div
                *ngIf="pageType === 'studentList'"
                role="button"
                class="text-orange text-decoration-underline whitespace-nowrap"
                [pRowToggler]="product"
              >
                รายละเอียดที่อยู่
              </div>

              <div
                class="text-orange text-decoration-underline whitespace-nowrap"
                role="button"
                *ngIf="pageType === 'graduateList'"
                (click)="viewAdress(product.address)"
              >
                รายละเอียดที่อยู่
              </div>
            </td>

            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === 'studentList'"
            >
              <div
                class="text-orange text-decoration-underline whitespace-nowrap"
                role="button"
                (click)="insertSubject(product.subject, product.index)"
              >
                รายวิชา
              </div>
            </td>

            <td class="d-flex justify-content-center">
              <i
                class="bi bi-pen text-primary p-2"
                *ngIf="!editing"
                type="button"
                pInitEditableRow
                (click)="onRowEditInit(product)"
              ></i>

              <div class="d-flex flex-column">
                <i
                  class="bi bi-x-lg text-danger"
                  *ngIf="editing"
                  type="button"
                  pCancelEditableRow
                  (click)="onRowEditCancel(product, ri)"
                ></i>

                <i
                  class="bi bi-check-lg text-success"
                  *ngIf="editing"
                  type="button"
                  pSaveEditableRow
                  (click)="onRowEditSave(product)"
                ></i>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="rowexpansion" let-product>
          <tr>
            <td></td>
            <td colspan="8">
              <form [formGroup]="product.address">
                <ksp-form-address-table formControlName="addressInfo"></ksp-form-address-table>
              </form>
            </td>
          </tr>
        </ng-template>
      </p-table>
      <div *ngIf="pageType === 'studentList'">
        <ksp-add-row-button class="blue" (click)="addStudent()">เพิ่มรายชื่อ</ksp-add-row-button>
      </div>
    </div>
  </div>
</div>

<div class="sticky-bottom border">
  <ksp-bottom-nav
    [isLastPage]="true"
    [isFirstPage]="true"
    [showCenterButtons]="true"
    [showSaveButton]="true"
    [showTempSaveButton]="true"
    [disableTempSaveButton]="false"
    (saveClicked)="save()"
    (cancelClicked)="cancel()"
    (tempSaveClicked)="tempSave()"
    [saveButtonLabel]="'บันทึกและยื่นใบคำขอ'"
  ></ksp-bottom-nav>
</div>
