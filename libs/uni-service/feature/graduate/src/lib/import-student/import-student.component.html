<ksp-top-nav>
  <span header>{{ headers[pageType][0] }}</span>
  <span subHeader>{{ headers[pageType][1] }}</span>
  <span detail> > {{ headers[pageType][2] }}</span>
</ksp-top-nav>

<div class="bg-secondary bg-opacity-10 px-4 py-2 full-height full-width-2">
  <div class="box-header">รายละเอียดใบคำขอ</div>

  <div class="bg-white p-3">
    <ksp-request-header-info
      [requestDate]="'10 ตุลาคม 2565'"
      [requestNumber]="'112234467876543'"
    ></ksp-request-header-info>
    <hr />

    <div class="d-flex justify-content-between mb-1">
      <div class="box-header">{{ headers[pageType][2] }}</div>
      <div *ngIf="pageType === importType.studentList">
        <button
          type="button"
          class="btn border-success text-success w-auto me-2"
        >
          <img src="/assets/images/img-uni/microsoft excel.png" />
          ดาวน์โหลดแบบฟอร์ม
        </button>

        <ksp-file-upload [showUploadedFileName]="false"></ksp-file-upload>
      </div>
    </div>

    <div class="table">
      <p-table
        [value]="users"
        responsiveLayout="scroll"
        dataKey="id"
        editMode="row"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="p-2 text-nowrap">เลือก</th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.studentList"
            >
              ลำดับ
            </th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              ครั้งที่สภาอนุมัติ
            </th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              วันที่สภาอนุมัติ
            </th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              วันที่จบการศึกษา
            </th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              สถานที่ปฏิบัติการสอน
            </th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.studentList"
            >
              วันที่รับเข้า
            </th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              วันที่เข้ารับการศึกษา
            </th>
            <th class="p-2 text-nowrap">
              เลขบัตรประจำตัวประชาชน /<br />
              เลขประจำตัวคุรุสภา
            </th>
            <th class="p-2 text-nowrap">หมายเลขหนังสือเดินทาง</th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.studentList"
            >
              สัญชาติ
            </th>

            <th
              class="p-2 text-nowrap text-center"
              colspan="3"
              style="width: 5rem"
            >
              ชื่อ-นามสกุล (ภาษาไทย)
            </th>

            <th
              class="p-2 text-nowrap text-center"
              colspan="3"
              style="width: 5rem"
            >
              ชื่อ-นามสกุล (ภาษาอังกฤษ)
            </th>
            <th class="p-2 text-nowrap">เบอร์โทรศัพท์มือถือ</th>
            <th class="p-2 text-nowrap">วัน/เดือน/ปีเกิด(พ.ศ.)</th>
            <th class="p-2 text-nowrap">ที่อยู่</th>
            <th
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.studentList"
            >
              รายวิชา
            </th>
            <th class="p-2 text-nowrap"></th>
          </tr>
        </ng-template>
        <ng-template
          pTemplate="body"
          let-product
          let-editing="editing"
          let-ri="rowIndex"
        >
          <tr [pEditableRow]="product">
            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.studentList"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  {{ product.id }}
                </ng-template>

                <ng-template pTemplate="output">
                  {{ product.id }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td
              class="text-center"
              *ngIf="pageType === importType.graduateList"
            >
              <input type="checkbox" />
            </td>

            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control text-center"
                    style="width: 75px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.approveTime"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.approveTime }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="date"
                    [(ngModel)]="product.graduateDate"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.graduateDate }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="date"
                    [(ngModel)]="product.approveDate"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.approveDate }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.graduateList"
            >
              <div
                (click)="searchAddress()"
                class="text-orange text-decoration-underline whitespace-nowrap"
                role="button"
              >
                สถานที่ปฏิบัติการสอน
              </div>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="date"
                    [(ngModel)]="product.startDate"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.startDate }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 175px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.personId"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.personId }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 175px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.passportId"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.passportId }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.studentList"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <select class="form-select" style="width: 150px">
                    <option
                      *ngFor="let nation of nationality"
                      [value]="nation.value"
                    >
                      {{ nation.label }}
                    </option>
                  </select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.nationality }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <select
                    class="form-select"
                    style="width: 100px"
                    [disabled]="pageType === importType.graduateList"
                  >
                    <option
                      *ngFor="let ThPrefix of ThPrefixes"
                      [value]="ThPrefix.value"
                    >
                      {{ ThPrefix.label }}
                    </option>
                  </select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.titleTh }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.firstNameTh"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.firstNameTh }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.lastNameTh"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.lastNameTh }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <select
                    class="form-select"
                    style="width: 100px"
                    [disabled]="pageType === importType.graduateList"
                  >
                    <option
                      *ngFor="let EngPrefix of EngPrefixes"
                      [value]="EngPrefix.value"
                    >
                      {{ EngPrefix.label }}
                    </option>
                  </select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.titleEn }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.firstNameEn"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.firstNameEn }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.lastNameEn"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.lastNameEn }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="text"
                    [(ngModel)]="product.phone"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.phone }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td class="p-2 text-nowrap">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="form-control"
                    style="width: 150px"
                    pInputText
                    type="date"
                    [(ngModel)]="product.birthDate"
                    [disabled]="pageType === importType.graduateList"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ product.birthDate }}
                </ng-template>
              </p-cellEditor>
            </td>

            <td class="p-2 text-nowrap">
              <div
                *ngIf="pageType === importType.studentList"
                role="button"
                class="text-orange text-decoration-underline whitespace-nowrap"
                [pRowToggler]="product"
              >
                รายละเอียดที่อยู่
              </div>

              <div
                class="text-orange text-decoration-underline whitespace-nowrap"
                role="button"
                *ngIf="pageType === importType.graduateList"
                (click)="viewAdress()"
              >
                รายละเอียดที่อยู่
              </div>
            </td>

            <td
              class="p-2 text-nowrap"
              *ngIf="pageType === importType.studentList"
            >
              <div
                class="text-orange text-decoration-underline whitespace-nowrap"
                role="button"
              >
                รายวิชา
              </div>
            </td>

            <td class="d-flex justify-content-center">
              <i
                class="bi bi-pen text-primary p-2"
                *ngIf="!editing"
                type="button"
                pInitEditableRow
                (click)="onRowEditInit(product)"
              ></i>

              <div class="d-flex flex-column">
                <i
                  class="bi bi-x-lg text-danger"
                  *ngIf="editing"
                  type="button"
                  pCancelEditableRow
                  (click)="onRowEditCancel(product, ri)"
                ></i>

                <i
                  class="bi bi-check-lg text-success"
                  *ngIf="editing"
                  type="button"
                  pSaveEditableRow
                  (click)="onRowEditSave(product)"
                ></i>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="rowexpansion" let-product>
          <tr>
            <td></td>
            <td colspan="4">
              <ksp-form-address-table></ksp-form-address-table>
            </td>
          </tr>
        </ng-template>
      </p-table>
      <div *ngIf="pageType === importType.studentList">
        <ksp-add-row-button class="blue">เพิ่มรายชื่อ</ksp-add-row-button>
      </div>
    </div>
  </div>
</div>

<div class="sticky-bottom border">
  <ksp-bottom-nav
    [isLastPage]="true"
    [isFirstPage]="true"
    [showCenterButtons]="true"
    [showSaveButton]="true"
    [showTempSaveButton]="true"
    (saveClicked)="save()"
    (cancelClicked)="cancel()"
  ></ksp-bottom-nav>
</div>
