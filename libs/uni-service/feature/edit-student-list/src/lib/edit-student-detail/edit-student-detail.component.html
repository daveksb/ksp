<div *ngIf="isLoading | async" class="overlay">
  <mat-progress-spinner class="spinner" mode="indeterminate">
  </mat-progress-spinner>
</div>
<ksp-top-nav
  ><span header>ยื่นแบบคำขอ</span>
  <span subHeader
    >ขอเปลี่ยนแปลงรายละเอียดรายชื่อผู้เข้าศึกษาและผู้สำเร็จการศึกษา</span
  ></ksp-top-nav
>

<div class="bg-secondary bg-opacity-10 py-2 px-4 full-height">
  <div class="box-header">
    รายละเอียดคำขอเปลี่ยนแปลงรายละเอียดรายชื่อผู้เข้าศึกษาและผู้สำเร็จการศึกษา
  </div>
  <div class="bg-white p-3">
    <ksp-request-header-info
      [requestNumber]="requestNo"
    ></ksp-request-header-info>
    <hr />
    <form [formGroup]="formSearch">
      <div class="box__contaner p-3">
        <div class="box-header text-primary">ค้นหาข้อมูล</div>
        <div class="row mb-3 mx-5">
          <div class="col-12">
            <label class="form-label">
              หมายเลขบัตรประชาชน / เลขประจำตัวคุรุสภา / หมายเลขหนังสือเดินทาง
            </label>
            <div class="col-6">
              <input
                type="text"
                class="form-control"
                formControlName="idcardno"
              />
            </div>
          </div>
        </div>

        <div class="row mb-3 mx-5">
          <div class="col">
            <label class="form-label">ชื่อ</label>
            <input
              type="text"
              class="form-control"
              formControlName="firstname"
            />
          </div>
          <div class="col">
            <label class="form-label">นามสกุล</label>
            <input
              type="text"
              class="form-control"
              formControlName="lastname"
            />
          </div>
        </div>

        <div class="d-flex justify-content-end me-5">
          <button
            class="btn border-primary text-primary bg-white"
            type="button"
            (click)="clearData()"
          >
            ล้างข้อมูล
          </button>
          <button
            class="btn btn-primary ms-2"
            type="button"
            (click)="searchData()"
          >
            ค้นหา
          </button>
        </div>
      </div>
    </form>
    <br />

    <form [formGroup]="studentDetail" *ngIf="data">
      <div class="bg-light p-3">
        <div class="box-header">ข้อมูลนักศึกษาที่ต้องการเปลี่ยนแปลง</div>
        <div class="row mb-2 mx-5">
          <div class="col-2">
            <label class="form-label">คำนำหน้าชื่อภาษาไทย</label>
            <select class="form-select" formControlName="prefixth">
              <option value="null" selected hidden disabled>กรุณาเลือก</option>
              <option
                *ngFor="let option of prefixList$ | async"
                [value]="option.id"
              >
                {{ option.name_th }}
              </option>
            </select>
          </div>
          <div class="col">
            <label class="form-label">ชื่อภาษาไทย</label
            ><input
              class="form-control"
              type="text"
              formControlName="firstnameth"
            />
          </div>
          <div class="col">
            <label class="form-label">นามสกุลภาษาไทย</label
            ><input
              class="form-control"
              type="text"
              formControlName="lastnameth"
            />
          </div>
        </div>

        <div class="row mb-2 mx-5">
          <div class="col-2">
            <label class="form-label">คำนำหน้าชื่อภาษาอังกฤษ</label>
            <select class="form-select" formControlName="prefixen">
              <option value="null" selected hidden disabled>กรุณาเลือก</option>
              <option
                *ngFor="let option of prefixList$ | async"
                [value]="option.id"
              >
                {{ option.name_en }}
              </option>
            </select>
          </div>
          <div class="col">
            <label class="form-label">ชื่อภาษาอังกฤษ</label
            ><input
              class="form-control"
              type="text"
              formControlName="firstnameen"
            />
          </div>
          <div class="col">
            <label class="form-label">นามสกุลภาษาอังกฤษ </label
            ><input
              class="form-control"
              type="text"
              formControlName="lastnameen"
            />
          </div>
        </div>

        <div class="row mb-2 mx-5">
          <div class="col-2">
            <label class="form-label">สัญชาติ</label>
            <select class="form-select" formControlName="nationality">
              <option value="null" selected hidden disabled>กรุณาเลือก</option>
              <option
                *ngFor="let option of nationalityList$ | async"
                [value]="option.nationId"
              >
                {{ option.nationName }}
              </option>
            </select>
          </div>
          <div class="col">
            <label class="form-label"
              >หมายเลขบัตรประชาชน / เลขประจำตัวคุรุสภา</label
            ><input
              class="form-control"
              type="text"
              formControlName="idcardno"
            />
          </div>
          <div class="col">
            <label class="form-label">หมายเลขหนังสือเดินทาง</label
            ><input
              class="form-control"
              type="text"
              formControlName="passportno"
            />
          </div>
        </div>

        <div class="row mb-2 mx-5">
          <div class="col">
            <label class="form-label">อีเมล</label
            ><input class="form-control" type="text" formControlName="email" />
          </div>
          <div class="col">
            <label class="form-label">เบอร์โทรศัพท์ </label
            ><input class="form-control" type="text" formControlName="phone" />
          </div>
        </div>
      </div>

      <br />
    </form>
    <form [formGroup]="formData" *ngIf="data">
      <ng-container>
        <div class="bg-light p-3">
          <div class="mx-5">
            <ksp-edit-license
              formControlName="editStudent"
              [oldValue]="oldValue"
              [showEditPassport]="true"
              [prefixList]="prefixList$ | async"
            ></ksp-edit-license>
          </div>
        </div>
        <br />
        <ksp-form-multi-attachment
          [uniqueTimestamp]="uniqueTimestamp"
          [pageType]="pageType.fileAttachTab"
          [requestType]="1"
          [groups]="uploadFileList"
        >
        </ksp-form-multi-attachment>
        <label class="text-red"
          >กรุณากรอกข้อมูลให้ถูกต้องเพื่อประโยชน์ของตัวท่านเอง
          โปรดตรวจสอบอีกครั้งก่อนบันทึกลงระบบ</label
        >
      </ng-container>
    </form>
    <div class="bg-light p-4 text-center" *ngIf="!data && isNotFound">
      <span>ไม่พบข้อมูล</span>
    </div>
  </div>
</div>
<div class="sticky-bottom border" *ngIf="data">
  <ksp-bottom-nav
    (cancelClicked)="cancel()"
    [isLastPage]="true"
    [isFirstPage]="true"
    [showCenterButtons]="true"
    [showSaveButton]="true"
    [disableSaveButton]="formData.invalid"
    (saveClicked)="save()"
  ></ksp-bottom-nav>
</div>
